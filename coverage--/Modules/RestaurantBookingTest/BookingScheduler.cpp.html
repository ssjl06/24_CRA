<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>BookingScheduler.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
ï»¿#pragma once
#include &lt;vector&gt;
#include &lt;stdexcept&gt;
#include &lt;algorithm&gt;
#include "Schedule.cpp"
#include "MailSender.cpp"
#include "SmsSender.cpp"

using std::vector;

class BookingScheduler {
public:
    BookingScheduler(int capacityPerHour) :
<span style = "background-color:#dfd">        capacityPerHour{ capacityPerHour } {
        smsSender = new SmsSender();
        mailSender = new MailSender();
    }</span>

<span style = "background-color:#dfd">    virtual time_t getNow() {
        return time(nullptr);
    }</span>

<span style = "background-color:#dfd">    void addSchedule(Schedule* schedule) {</span>

        // ì ê°ì ìì½íì§ ìì ê²½ì° RuntimeException ë°ì
<span style = "background-color:#dfd">        if (schedule-&gt;getDateTime().tm_min != 0) {
            throw std::runtime_error("Booking should be on the hour.");</span>
        }

        // ìê°ë¹ ìì½ì¸ìì ì´ê³¼í  ê²½ì° RuntimeException ë°ì
<span style = "background-color:#dfd">        int numberOfPeople = schedule-&gt;getNumberOfPeople();
        for (Schedule* bookedSchedule : schedules) {
            if (isSameTime(bookedSchedule-&gt;getDateTime(), schedule-&gt;getDateTime())) {
                numberOfPeople += bookedSchedule-&gt;getNumberOfPeople();</span>
            }
<span style = "background-color:#dfd">        }
        if (numberOfPeople &gt; capacityPerHour) {
            throw std::runtime_error("Number of people is over restaurant capacity per hour");</span>
        }

        // ì¼ìì¼ìë ìì¤íì ì¤ííì§ ìëë¤.
<span style = "background-color:#dfd">        time_t now = getNow();
        if (getDayOfWeek(now) == "Sunday") {
            throw std::runtime_error("Booking system is not available on sunday");</span>
        }

<span style = "background-color:#dfd">        schedules.push_back(schedule);</span>

        // ê³ ê°ìê² SMS ë°ì¡
<span style = "background-color:#dfd">        smsSender-&gt;send(schedule);</span>
        // ê³ ê°ì´ E Mailì ê°ì§ê³  ìì ê²½ì° E Mail ë°ì¡
<span style = "background-color:#dfd">        if (schedule-&gt;getCustomer().getEmail() != "") {
            mailSender-&gt;sendMail(schedule);</span>
        }
<span style = "background-color:#dfd">    }</span>

<span style = "background-color:#dfd">    bool hasSchedule(Schedule* schedule) {</span>
        //check if an element exists in array
<span style = "background-color:#dfd">        return std::find(schedules.begin(), schedules.end(), schedule) != schedules.end();
    }</span>

<span style = "background-color:#dfd">    void setSmsSender(SmsSender* smsSender) {
        this-&gt;smsSender = smsSender;
    }</span>

<span style = "background-color:#dfd">    void setMailSender(MailSender* mailSender) {
        this-&gt;mailSender = mailSender;
    }</span>

private:
    //ë ìê°ì´ ê°ìì§ íì¸
<span style = "background-color:#dfd">    bool isSameTime(tm a, tm b) {
        return mktime(&amp;a) == mktime(&amp;b);
    }</span>

    //ìì¼ì ìë ¤ì£¼ë í¨ì
<span style = "background-color:#dfd">    string getDayOfWeek(time_t tm_t) {</span>
        tm tmTime;
<span style = "background-color:#dfd">        localtime_s(&amp;tmTime, &amp;tm_t);
        char buffer[100] = { 0 };
        std::strftime(buffer, sizeof(buffer), "%A", &amp;tmTime);
        return string{ buffer };
    }</span>

    int capacityPerHour;
    vector&lt;Schedule*&gt; schedules;
    SmsSender* smsSender;
    MailSender* mailSender;
};
</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>